define(function(a,b,c){"use strict";function d(a){var b={};for(var c in a)b[c]=a[c];return b}function e(a){this.blob=a}function f(a,b,c,d){d||("object"==typeof b?(d=b,b=void 0):d={}),this.url=a,this.start=b||0,c&&(this.end=c),this.opts=d}function g(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}function h(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function i(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function j(a,b){return a[b+1]<<8|a[b]}function k(a,b){return a[b]}function l(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}if("undefined"!=typeof a)var m=a("libs/bbi/sha1"),n=m.b64_sha1;e.prototype.slice=function(a,b){var c;return c=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a),new e(c)},e.prototype.salted=function(){return this},e.prototype.fetch="undefined"!=typeof FileReader?function(a){var b=new FileReader;b.onloadend=function(){a(g(b.result))},b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var c=b.readAsArrayBuffer(this.blob);a(c)}catch(d){a(null,d)}},f.prototype.slice=function(a,b){if(0>a)throw"Bad slice "+a;var c=this.start,d=this.end;return c&&a?c+=a:c=a||c,d=b&&c?c+b-1:d||b-1,new f(this.url,c,d,this.opts)};var o=0,p=navigator.userAgent.indexOf("Safari")>=0&&navigator.userAgent.indexOf("Chrome")<0;f.prototype.fetchAsText=function(a){try{var b,c=new XMLHttpRequest,d=this.url;if((p||this.opts.salt)&&d.indexOf("?")<0&&(d=d+"?salt="+n(""+Date.now()+","+ ++o)),c.open("GET",d,!0),this.end){if(this.end-this.start>1e8)throw"Monster fetch!";c.setRequestHeader("Range","bytes="+this.start+"-"+this.end),b=this.end-this.start+1}c.onreadystatechange=function(){return 4==c.readyState?a(200==c.status||206==c.status?c.responseText:null):void 0},this.opts.credentials&&(c.withCredentials=!0),c.send("")}catch(e){return a(null)}},f.prototype.salted=function(){var a=d(this.opts);return a.salt=!1,new f(this.url,this.start,this.end,a)},f.prototype.fetch=function(a,b){var c=this;b=b||{};var d=b.attempt||1,e=b.truncatedLength;if(d>3)return a(null);try{var f;b.timeout&&!this.opts.credentials&&(f=setTimeout(function(){return console.log("timing out "+j),i.abort(),a(null,"Timeout")},b.timeout));var h,i=new XMLHttpRequest,j=this.url;if((p||this.opts.salt)&&j.indexOf("?")<0,i.open("GET",j,!0),i.overrideMimeType("text/plain; charset=x-user-defined"),this.end){if(this.end-this.start>1e8)throw"Monster fetch!";i.setRequestHeader("Range","bytes="+this.start+"-"+this.end),h=this.end-this.start+1}i.responseType="arraybuffer",i.onreadystatechange=function(){if(4==i.readyState){if(f&&clearTimeout(f),200==i.status||206==i.status){if(i.response){var b=i.response.byteLength;return!h||h==b||e&&b==e?a(i.response):c.fetch(a,{attempt:d+1,truncatedLength:b})}if(i.mozResponseArrayBuffer)return a(i.mozResponseArrayBuffer);var j=i.responseText;return!h||h==j.length||e&&j.length==e?a(g(i.responseText)):c.fetch(a,{attempt:d+1,truncatedLength:j.length})}return c.fetch(a,{attempt:d+1})}},this.opts.credentials&&(i.withCredentials=!0),i.send("")}catch(k){return a(null)}},function(a){var b=new ArrayBuffer(8),c=new Uint8Array(b),d=new Float32Array(b);a.readFloat=function(a,b){return c[0]=a[b],c[1]=a[b+1],c[2]=a[b+2],c[3]=a[b+3],d[0]}}(this),"undefined"!=typeof c&&(c.exports={BlobFetchable:e,URLFetchable:f,readInt:i,readIntBE:l,readInt64:h,readShort:j,readByte:k,readFloat:this.readFloat})});
//# sourceMappingURL=../../../maps/libs/bbi/bin.js.map
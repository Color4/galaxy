{"version":3,"sources":["layout/menu.js"],"names":["define","Collection","model","defaults","target","Webhooks","_l","Utils","Backbone","extend","Model","self","options","fetch","extendedNavItem","GenericNav","GenericNavView","this","add","render","id","title","url","tooltip","disabled","Galaxy","user","menu","lims_doc_url","webhook","obj","onclick","callback","webhooks","appendScriptStyle","$","each","models","index","toJSON","activate","name","icon","config","function","Function","page","masthead","collection","get","screencasts_url","terms_url","helpTab","support_url","biostar_url","search_url","mailing_lists","biostar_url_redirect","wiki_url","allow_user_creation","cls","citation_url","noscratchbook","userTab","unshift","setElement","$dropdown","_formatUrl","session_csrf_token","divider","show","hide","append","activeView","jQuery","Deferred","active_view","set","resolve","promise","Tab","View","_template","$menu","e","preventDefault","events","remove","_toggleClick","attr","css","trigger","m","removeClass","display","$toggle","buildLink","label","addClass","popover","content","setTimeout","placement","off","on","empty","_","menuItem","_buildMenuItem","html","frame","root","attributes","indexOf","charAt"],"mappings":"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","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\ndefine(\n    [\n        \"layout/generic-nav-view\",\n        \"mvc/webhooks\",\n        \"utils/localization\",\n        \"utils/utils\"\n    ],\n    function(GenericNav, Webhooks, _l, Utils) {\n        var Collection = Backbone.Collection.extend({\n            model: Backbone.Model.extend({\n                defaults: {\n                    visible: true,\n                    target: \"_parent\"\n                }\n            }),\n            fetch: function(options) {\n                var self = this;\n                options = options || {};\n                this.reset();\n\n                //\n                // Chat server tab\n                //\n                var extendedNavItem = new GenericNav.GenericNavView();\n                this.add(extendedNavItem.render());\n\n                //\n                // Analyze data tab.\n                //\n                this.add({\n                    id: \"analysis\",\n                    title: _l(\"Analyze Data\"),\n                    url: \"\",\n                    tooltip: _l(\"Analysis home view\")\n                });\n\n                //\n                // Workflow tab.\n                //\n                this.add({\n                    id: \"workflow\",\n                    title: _l(\"Workflow\"),\n                    tooltip: _l(\"Chain tools into workflows\"),\n                    disabled: !Galaxy.user.id,\n                    url: \"workflow\"\n                });\n\n                //\n                // 'Shared Items' or Libraries tab.\n                //\n                this.add({\n                    id: \"shared\",\n                    title: _l(\"Shared Data\"),\n                    url: \"library/index\",\n                    tooltip: _l(\"Access published resources\"),\n                    menu: [\n                        {\n                            title: _l(\"Data Libraries\"),\n                            url: \"library/list\"\n                        },\n                        {\n                            title: _l(\"Histories\"),\n                            url: \"histories/list_published\"\n                        },\n                        {\n                            title: _l(\"Workflows\"),\n                            url: \"workflows/list_published\"\n                        },\n                        {\n                            title: _l(\"Visualizations\"),\n                            url: \"visualizations/list_published\"\n                        },\n                        {\n                            title: _l(\"Pages\"),\n                            url: \"pages/list_published\"\n                        }\n                    ]\n                });\n\n                //\n                // Lab menu.\n                //\n                options.user_requests &&\n                    this.add({\n                        id: \"lab\",\n                        title: \"Lab\",\n                        menu: [\n                            {\n                                title: \"Sequencing Requests\",\n                                url: \"requests/index\"\n                            },\n                            {\n                                title: \"Find Samples\",\n                                url: \"requests/find_samples_index\"\n                            },\n                            {\n                                title: \"Help\",\n                                url: options.lims_doc_url\n                            }\n                        ]\n                    });\n\n                //\n                // Visualization tab.\n                //\n                this.add({\n                    id: \"visualization\",\n                    title: _l(\"Visualization\"),\n                    url: \"visualizations/list\",\n                    tooltip: _l(\"Visualize datasets\"),\n                    disabled: !Galaxy.user.id,\n                    menu: [\n                        {\n                            title: _l(\"New Track Browser\"),\n                            url: \"visualization/trackster\",\n                            target: \"_frame\"\n                        },\n                        {\n                            title: _l(\"Saved Visualizations\"),\n                            url: \"visualizations/list\",\n                            target: \"_frame\"\n                        },\n                        {\n                            title: _l(\"Interactive Environments\"),\n                            url: \"visualization/gie_list\",\n                            target: \"galaxy_main\"\n                        }\n                    ]\n                });\n\n                //\n                // Webhooks\n                //\n                Webhooks.add({\n                    url: \"api/webhooks/masthead/all\",\n                    callback: function(webhooks) {\n                        $(document).ready(function() {\n                            $.each(webhooks.models, function(index, model) {\n                                var webhook = model.toJSON();\n                                if (webhook.activate) {\n                                    var obj = {\n                                        id: webhook.name,\n                                        icon: webhook.config.icon,\n                                        url: webhook.config.url,\n                                        tooltip: webhook.config.tooltip,\n                                        onclick:\n                                            webhook.config.function &&\n                                            new Function(\n                                                webhook.config.function\n                                            )\n                                    };\n\n                                    // Galaxy.page is undefined for data libraries, workflows pages\n                                    if (Galaxy.page) {\n                                        Galaxy.page.masthead.collection.add(\n                                            obj\n                                        );\n                                    } else if (Galaxy.masthead) {\n                                        Galaxy.masthead.collection.add(obj);\n                                    }\n\n                                    // Append masthead script and styles to Galaxy main\n                                    Utils.appendScriptStyle(webhook);\n                                }\n                            });\n                        });\n                    }\n                });\n\n                //\n                // Admin.\n                //\n                Galaxy.user.get(\"is_admin\") &&\n                    this.add({\n                        id: \"admin\",\n                        title: _l(\"Admin\"),\n                        url: \"admin\",\n                        tooltip: _l(\"Administer this Galaxy\"),\n                        cls: \"admin-only\"\n                    });\n\n                //\n                // Help tab.\n                //\n                var helpTab = {\n                    id: \"help\",\n                    title: _l(\"Help\"),\n                    tooltip: _l(\"Support, contact, and community\"),\n                    menu: [\n                        {\n                            title: _l(\"Support\"),\n                            url: options.support_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Search\"),\n                            url: options.search_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Mailing Lists\"),\n                            url: options.mailing_lists,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Videos\"),\n                            url: options.screencasts_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Wiki\"),\n                            url: options.wiki_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"How to Cite Galaxy\"),\n                            url: options.citation_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Interactive Tours\"),\n                            url: \"tours\"\n                        }\n                    ]\n                };\n                options.terms_url &&\n                    helpTab.menu.push({\n                        title: _l(\"Terms and Conditions\"),\n                        url: options.terms_url,\n                        target: \"_blank\"\n                    });\n                options.biostar_url &&\n                    helpTab.menu.unshift({\n                        title: _l(\"Ask a question\"),\n                        url: \"biostar/biostar_question_redirect\",\n                        target: \"_blank\"\n                    });\n                options.biostar_url &&\n                    helpTab.menu.unshift({\n                        title: _l(\"Galaxy Biostar\"),\n                        url: options.biostar_url_redirect,\n                        target: \"_blank\"\n                    });\n                this.add(helpTab);\n\n                //\n                // User tab.\n                //\n                var userTab = {};\n                if (!Galaxy.user.id) {\n                    if (options.allow_user_creation) {\n                        userTab = {\n                            id: \"user\",\n                            title: _l(\"Login or Register\"),\n                            cls: \"loggedout-only\",\n                            tooltip: _l(\"Account registration or login\"),\n                            menu: [\n                                {\n                                    title: _l(\"Login\"),\n                                    url: \"user/login\",\n                                    target: \"galaxy_main\",\n                                    noscratchbook: true\n                                },\n                                {\n                                    title: _l(\"Register\"),\n                                    url: \"user/create\",\n                                    target: \"galaxy_main\",\n                                    noscratchbook: true\n                                }\n                            ]\n                        };\n                    } else {\n                        userTab = {\n                            id: \"user\",\n                            title: _l(\"Login\"),\n                            cls: \"loggedout-only\",\n                            tooltip: _l(\"Login\"),\n                            url: \"user/login\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        };\n                    }\n                } else {\n                    userTab = {\n                        id: \"user\",\n                        title: _l(\"User\"),\n                        cls: \"loggedin-only\",\n                        tooltip: _l(\"Account and saved data\"),\n                        menu: [\n                            {\n                                title:\n                                    _l(\"Logged in as\") +\n                                    \" \" +\n                                    Galaxy.user.get(\"email\")\n                            },\n                            {\n                                title: _l(\"Preferences\"),\n                                url: \"user\"\n                            },\n                            {\n                                title: _l(\"Custom Builds\"),\n                                url: \"custom_builds\"\n                            },\n                            {\n                                title: _l(\"Logout\"),\n                                url:\n                                    \"user/logout?session_csrf_token=\" +\n                                    Galaxy.session_csrf_token,\n                                target: \"_top\",\n                                divider: true\n                            },\n                            {\n                                title: _l(\"Saved Histories\"),\n                                url: \"histories/list\",\n                                target: \"_top\"\n                            },\n                            {\n                                title: _l(\"Saved Datasets\"),\n                                url: \"datasets/list\",\n                                target: \"_top\"\n                            },\n                            {\n                                title: _l(\"Saved Pages\"),\n                                url: \"pages/list\",\n                                target: \"_top\"\n                            }\n                        ]\n                    };\n                }\n                this.add(userTab);\n                var activeView = this.get(options.active_view);\n                activeView && activeView.set(\"active\", true);\n                return new jQuery.Deferred().resolve().promise();\n            }\n        });\n\n        /** Masthead tab **/\n        var Tab = Backbone.View.extend({\n            initialize: function(options) {\n                this.model = options.model;\n                this.setElement(this._template());\n                this.$dropdown = this.$(\".dropdown\");\n                this.$toggle = this.$(\".dropdown-toggle\");\n                this.$menu = this.$(\".dropdown-menu\");\n                this.$note = this.$(\".dropdown-note\");\n                this.listenTo(this.model, \"change\", this.render, this);\n            },\n\n            events: {\n                \"click .dropdown-toggle\": \"_toggleClick\"\n            },\n\n            render: function() {\n                var self = this;\n                $(\".tooltip\").remove();\n                this.$el.attr(\"id\", this.model.id).css({\n                    visibility:\n                        (this.model.get(\"visible\") && \"visible\") || \"hidden\"\n                });\n                this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n                this.$note\n                    .html(this.model.get(\"note\") || \"\")\n                    .removeClass()\n                    .addClass(\"dropdown-note\")\n                    .addClass(this.model.get(\"note_cls\"))\n                    .css({\n                        display:\n                            (this.model.get(\"show_note\") && \"block\") || \"none\"\n                    });\n                this.$toggle\n                    .html(this.model.get(\"title\") || \"\")\n                    .removeClass()\n                    .addClass(\"dropdown-toggle\")\n                    .addClass(this.model.get(\"cls\"))\n                    .addClass(\n                        this.model.get(\"icon\") &&\n                            \"dropdown-icon fa \" + this.model.get(\"icon\")\n                    )\n                    .addClass(this.model.get(\"toggle\") && \"toggle\")\n                    .attr(\"target\", this.model.get(\"target\"))\n                    .attr(\"href\", this.model.get(\"url\"))\n                    .attr(\"title\", this.model.get(\"tooltip\"))\n                    .tooltip(\"destroy\");\n                this.model.get(\"tooltip\") &&\n                    this.$toggle.tooltip({ placement: \"bottom\" });\n                this.$dropdown\n                    .removeClass()\n                    .addClass(\"dropdown\")\n                    .addClass(this.model.get(\"disabled\") && \"disabled\")\n                    .addClass(this.model.get(\"active\") && \"active\");\n                if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n                    this.$menu.show();\n                    $(\"#dd-helper\")\n                        .show()\n                        .off()\n                        .on(\"click\", function() {\n                            $(\"#dd-helper\").hide();\n                            self.model.set(\"show_menu\", false);\n                        });\n                } else {\n                    self.$menu.hide();\n                    $(\"#dd-helper\").hide();\n                }\n                this.$menu.empty().removeClass(\"dropdown-menu\");\n                if (this.model.get(\"menu\")) {\n                    _.each(this.model.get(\"menu\"), function(menuItem) {\n                        self.$menu.append(self._buildMenuItem(menuItem));\n                        menuItem.divider &&\n                            self.$menu.append($(\"<li/>\").addClass(\"divider\"));\n                    });\n                    self.$menu.addClass(\"dropdown-menu\");\n                    self.$toggle.append($(\"<b/>\").addClass(\"caret\"));\n                }\n                return this;\n            },\n\n            /** Add new menu item */\n            _buildMenuItem: function(options) {\n                var self = this;\n                options = _.defaults(options || {}, {\n                    title: \"\",\n                    url: \"\",\n                    target: \"_parent\",\n                    noscratchbook: false\n                });\n                options.url = self._formatUrl(options.url);\n                return $(\"<li/>\").append(\n                    $(\"<a/>\")\n                        .attr(\"href\", options.url)\n                        .attr(\"target\", options.target)\n                        .html(options.title)\n                        .on(\"click\", function(e) {\n                            e.preventDefault();\n                            self.model.set(\"show_menu\", false);\n                            if (options.onclick) {\n                                options.onclick();\n                            } else {\n                                Galaxy.frame.add(options);\n                            }\n                        })\n                );\n            },\n\n            /** Handle click event */\n            _toggleClick: function(e) {\n                var self = this;\n                var model = this.model;\n                e.preventDefault();\n                $(\".tooltip\").hide();\n                model.trigger(\"dispatch\", function(m) {\n                    model.id !== m.id &&\n                        m.get(\"menu\") &&\n                        m.set(\"show_menu\", false);\n                });\n                if (!model.get(\"disabled\")) {\n                    if (!model.get(\"menu\")) {\n                        model.get(\"onclick\")\n                            ? model.get(\"onclick\")()\n                            : Galaxy.frame.add(model.attributes);\n                    } else {\n                        model.set(\"show_menu\", true);\n                    }\n                } else {\n                    function buildLink(label, url) {\n                        return $(\"<div/>\")\n                            .append(\n                                $(\"<a/>\")\n                                    .attr(\"href\", Galaxy.root + url)\n                                    .html(label)\n                            )\n                            .html();\n                    }\n                    this.$toggle.popover && this.$toggle.popover(\"destroy\");\n                    this.$toggle\n                        .popover({\n                            html: true,\n                            placement: \"bottom\",\n                            content:\n                                \"Please \" +\n                                buildLink(\n                                    \"login\",\n                                    \"user/login?use_panels=True\"\n                                ) +\n                                \" or \" +\n                                buildLink(\n                                    \"register\",\n                                    \"user/create?use_panels=True\"\n                                ) +\n                                \" to use this feature.\"\n                        })\n                        .popover(\"show\");\n                    setTimeout(function() {\n                        self.$toggle.popover(\"destroy\");\n                    }, 5000);\n                }\n            },\n\n            /** Url formatting */\n            _formatUrl: function(url) {\n                return typeof url == \"string\" &&\n                    url.indexOf(\"//\") === -1 &&\n                    url.charAt(0) != \"/\"\n                    ? Galaxy.root + url\n                    : url;\n            },\n\n            /** body tempate */\n            _template: function() {\n                return (\n                    '<ul class=\"nav navbar-nav\">' +\n                    '<li class=\"dropdown\">' +\n                    '<a class=\"dropdown-toggle\"/>' +\n                    '<ul class=\"dropdown-menu\"/>' +\n                    '<div class=\"dropdown-note\"/>' +\n                    \"</li>\" +\n                    \"</ul>\"\n                );\n            }\n        });\n\n        return {\n            Collection: Collection,\n            Tab: Tab\n        };\n    }\n);\n"]}